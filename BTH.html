<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Chem: Bảng Tuần Hoàn</title>
    <style>
        :root {
            --bg-color: #0f172a; /* Xanh đen vũ trụ */
            --card-bg: #1e293b;
            --neon-blue: #00f3ff;
            --neon-green: #00ff9d;
            --neon-red: #ff0055;
            --text-main: #e2e8f0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            user-select: none; /* Chống bôi đen text khi chơi */
        }

        /* --- HEADER --- */
        .header {
            text-align: center;
            padding: 10px;
            background: rgba(30, 41, 59, 0.9);
            border-bottom: 2px solid var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue);
            z-index: 10;
        }
        .header h2 { margin: 0; font-size: 18px; color: var(--neon-blue); text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 5px var(--neon-blue); }
        .score-board { font-size: 12px; margin-top: 5px; color: #94a3b8; }

        /* --- BẢNG TUẦN HOÀN --- */
        #board-wrapper {
            flex: 2;
            overflow: auto;
            padding: 20px;
            position: relative;
            /* Tạo lưới nền cyber */
            background-image: linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 30px repeat(18, 42px);
            grid-template-rows: 30px repeat(7, 42px);
            gap: 4px;
            width: max-content;
            margin: 0 auto;
        }

        .label-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #64748b;
            font-weight: bold;
        }
        .label-col { color: var(--neon-blue); }
        .label-row { color: var(--neon-green); }

        .slot {
            width: 42px;
            height: 42px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        /* Hiệu ứng khi bấm vào ô */
        .slot:active { transform: scale(0.9); }

        /* Khi điền đúng */
        .slot.filled {
            background: rgba(0, 255, 157, 0.2);
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green), inset 0 0 10px rgba(0, 255, 157, 0.2);
            text-shadow: 0 0 5px var(--neon-green);
        }

        /* Khi điền sai */
        .slot.incorrect {
            animation: shake 0.4s;
            background: rgba(255, 0, 85, 0.3);
            border: 1px solid var(--neon-red);
        }

        /* --- KHU VỰC THẺ BÀI --- */
        #hand-container {
            flex: 1;
            padding: 15px;
            background: #0b1120;
            border-top: 1px solid #334155;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        .card-info {
            width: 95%;
            max-width: 400px;
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 12px;
            display: grid;
            grid-template-columns: 60px 1fr auto;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card-info:hover { transform: translateY(-2px); }

        .card-info.selected {
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue);
            background: #1e293b;
            transform: scale(1.02);
        }

        .symbol-large {
            font-size: 28px; font-weight: bold; color: white;
            background: var(--neon-blue);
            width: 50px; height: 50px;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            text-shadow: 1px 1px 2px black;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        .details b { color: var(--neon-blue); font-size: 16px; }
        .details .hint { color: #94a3b8; font-size: 13px; font-style: italic; display: block; margin-top: 4px; }
        .details .hint span { color: var(--neon-green); font-weight: bold; } /* Highlight cấu hình e */

        .z-tag {
            background: #334155; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; color: #fff;
        }

        .empty-space { visibility: hidden; pointer-events: none; }

        /* --- HIỆU ỨNG ANIMATION --- */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Hạt nổ (Particles) */
        .particle {
            position: absolute;
            width: 6px; height: 6px;
            background: var(--neon-green);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
        }

        /* Pháo hoa */
        #confetti-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 999;
        }

    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="header">
        <h2>Cyber Chem: Elements</h2>
        <div class="score-board" id="status-text">CHẠM THẺ &rarr; CHỌN VỊ TRÍ</div>
    </div>

    <div id="board-wrapper">
        <div class="grid-container" id="periodic-table">
            </div>
    </div>

    <div id="hand-container">
        </div>

    <script>
        /* --- DỮ LIỆU --- */
        const elementsData = [
            { z: 1, row: 1, col: 1, sym: 'H', name: 'Hydrogen', conf: '1s¹' },
            { z: 2, row: 1, col: 18, sym: 'He', name: 'Helium', conf: '1s²' },
            { z: 3, row: 2, col: 1, sym: 'Li', name: 'Lithium', conf: '[He]2s¹' },
            { z: 4, row: 2, col: 2, sym: 'Be', name: 'Beryllium', conf: '[He]2s²' },
            { z: 5, row: 2, col: 13, sym: 'B', name: 'Boron', conf: '...2s²2p¹' },
            { z: 6, row: 2, col: 14, sym: 'C', name: 'Carbon', conf: '...2s²2p²' },
            { z: 7, row: 2, col: 15, sym: 'N', name: 'Nitrogen', conf: '...2s²2p³' },
            { z: 8, row: 2, col: 16, sym: 'O', name: 'Oxygen', conf: '...2s²2p⁴' },
            { z: 9, row: 2, col: 17, sym: 'F', name: 'Fluorine', conf: '...2s²2p⁵' },
            { z: 10, row: 2, col: 18, sym: 'Ne', name: 'Neon', conf: '...2s²2p⁶' },
            { z: 11, row: 3, col: 1, sym: 'Na', name: 'Sodium', conf: '[Ne]3s¹' },
            { z: 12, row: 3, col: 2, sym: 'Mg', name: 'Magnesium', conf: '[Ne]3s²' },
            { z: 13, row: 3, col: 13, sym: 'Al', name: 'Aluminium', conf: '...3s²3p¹' },
            { z: 14, row: 3, col: 14, sym: 'Si', name: 'Silicon', conf: '...3s²3p²' },
            { z: 15, row: 3, col: 15, sym: 'P', name: 'Phosphorus', conf: '...3s²3p³' },
            { z: 16, row: 3, col: 16, sym: 'S', name: 'Sulfur', conf: '...3s²3p⁴' },
            { z: 17, row: 3, col: 17, sym: 'Cl', name: 'Chlorine', conf: '...3s²3p⁵' },
            { z: 18, row: 3, col: 18, sym: 'Ar', name: 'Argon', conf: '...3s²3p⁶' },
            { z: 19, row: 4, col: 1, sym: 'K', name: 'Potassium', conf: '[Ar]4s¹' },
            { z: 20, row: 4, col: 2, sym: 'Ca', name: 'Calcium', conf: '[Ar]4s²' }
        ];

        const groupLabels = ['', 'IA', 'IIA', '', '', '', '', '', '', '', '', '', '', 'IIIA', 'IVA', 'VA', 'VIA', 'VIIA', 'VIIIA'];

        let selectedElement = null;
        let selectedCardDiv = null;

        const table = document.getElementById('periodic-table');
        const hand = document.getElementById('hand-container');
        const statusText = document.getElementById('status-text');

        /* --- HỆ THỐNG ÂM THANH (Web Audio API - Không cần file) --- */
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'correct') {
                // Tiếng "Ting" cao vút
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                // Tiếng "Buzz" trầm
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'win') {
                // Hợp âm chiến thắng
                [440, 554, 659].forEach((freq, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g); g.connect(audioCtx.destination);
                    o.type = 'triangle';
                    o.frequency.value = freq;
                    g.gain.setValueAtTime(0.2, audioCtx.currentTime + i*0.1);
                    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + i*0.1 + 2);
                    o.start(audioCtx.currentTime + i*0.1);
                    o.stop(audioCtx.currentTime + i*0.1 + 2);
                });
            }
        }

        /* --- HỆ THỐNG HIỆU ỨNG HẠT (Particles) --- */
        function createParticles(x, y) {
            for (let i = 0; i < 15; i++) {
                const p = document.createElement('div');
                p.classList.add('particle');
                document.body.appendChild(p);
                
                // Vị trí ngẫu nhiên xung quanh điểm click
                const angle = Math.random() * Math.PI * 2;
                const velocity = 2 + Math.random() * 5;
                const tx = Math.cos(angle) * 50 * Math.random();
                const ty = Math.sin(angle) * 50 * Math.random();

                p.style.left = x + 'px';
                p.style.top = y + 'px';
                
                // Animation bằng Web Animations API
                p.animate([
                    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
                ], {
                    duration: 500 + Math.random() * 300,
                    easing: 'cubic-bezier(0, .9, .57, 1)',
                }).onfinish = () => p.remove();
            }
        }

        /* --- LOGIC GAME --- */
        function initBoard() {
            // Góc trái
            let corner = document.createElement('div');
            corner.className = 'label-cell';
            corner.innerHTML = "CK/N";
            table.appendChild(corner);

            // Nhóm
            for (let c = 1; c <= 18; c++) {
                let colLabel = document.createElement('div');
                colLabel.className = 'label-cell label-col';
                colLabel.innerText = groupLabels[c] || c;
                if(!groupLabels[c]) colLabel.style.opacity = "0.2";
                table.appendChild(colLabel);
            }

            // Hàng + Ô
            for (let r = 1; r <= 7; r++) {
                let rowLabel = document.createElement('div');
                rowLabel.className = 'label-cell label-row';
                rowLabel.innerText = r;
                table.appendChild(rowLabel);

                for (let c = 1; c <= 18; c++) {
                    const slot = document.createElement('div');
                    const targetEl = elementsData.find(e => e.row === r && e.col === c);

                    if (targetEl) {
                        slot.className = 'slot';
                        slot.dataset.z = targetEl.z;
                        slot.onclick = (e) => handleSlotClick(slot, e);
                    } else {
                        const isMainBlock = (r <= 3 && (c<=2 || c>=13)) || (r==4 && c<=2);
                        slot.className = isMainBlock || r > 4 ? 'slot empty-space' : 'slot empty-space';
                    }
                    table.appendChild(slot);
                }
            }
        }

        function initHand() {
            const shuffled = [...elementsData].sort(() => 0.5 - Math.random());
            shuffled.forEach(el => {
                const card = document.createElement('div');
                card.className = 'card-info';
                card.innerHTML = `
                    <div class="symbol-large">${el.sym}</div>
                    <div class="details">
                        <b>${el.name}</b>
                        <span class="hint">Cấu hình: <span>${el.conf}</span></span>
                    </div>
                    <div class="z-tag">Z = ${el.z}</div>
                `;
                card.onclick = () => selectCard(el, card);
                hand.appendChild(card);
            });
        }

        function selectCard(elData, cardDiv) {
            // Hiệu ứng rung nhẹ khi chọn (Haptic feedback giả lập)
            if (navigator.vibrate) navigator.vibrate(10); 
            
            if (selectedCardDiv) selectedCardDiv.classList.remove('selected');
            selectedElement = elData;
            selectedCardDiv = cardDiv;
            cardDiv.classList.add('selected');
            statusText.innerText = `ĐANG CHỌN: ${elData.name.toUpperCase()} (Z=${elData.z})`;
            statusText.style.color = "var(--neon-blue)";
        }

        function handleSlotClick(slot, event) {
            if (!selectedElement) return;
            if (slot.classList.contains('filled')) return;

            if (selectedElement.z === parseInt(slot.dataset.z)) {
                // --- ĐÚNG ---
                slot.classList.add('filled');
                slot.innerText = selectedElement.sym;
                
                playSound('correct'); // Âm thanh
                
                // Hiệu ứng hạt nổ ngay ngón tay
                const rect = slot.getBoundingClientRect();
                createParticles(rect.left + rect.width/2, rect.top + rect.height/2);

                selectedCardDiv.style.opacity = '0';
                setTimeout(() => selectedCardDiv.remove(), 300);
                
                selectedElement = null; 
                selectedCardDiv = null;
                statusText.innerText = "CHÍNH XÁC! TUYỆT VỜI.";
                statusText.style.color = "var(--neon-green)";

                // Check Win
                if (hand.children.length <= 1) { // 1 vì cái thẻ đang xóa chưa remove hẳn
                    setTimeout(() => {
                        playSound('win');
                        startConfetti();
                        statusText.innerText = "NHIỆM VỤ HOÀN THÀNH!";
                        alert("MISSION COMPLETE!\nBạn là bậc thầy bảng tuần hoàn.");
                    }, 500);
                }

            } else {
                // --- SAI ---
                slot.classList.add('incorrect');
                playSound('wrong');
                if (navigator.vibrate) navigator.vibrate([50, 50, 50]); // Rung điện thoại
                setTimeout(() => slot.classList.remove('incorrect'), 500);
                
                statusText.innerText = "SAI VỊ TRÍ! KIỂM TRA LẠI SỐ LỚP VÀ E LỚP NGOÀI CÙNG.";
                statusText.style.color = "var(--neon-red)";
            }
        }

        /* --- PHÁO HOA ĐƠN GIẢN (CONFETTI) --- */
        function startConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const pieces = [];
            const colors = ['#00f3ff', '#00ff9d', '#ff0055', '#ffff00'];

            for(let i=0; i<100; i++) {
                pieces.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 8 + 4,
                    speed: Math.random() * 5 + 2,
                    angle: Math.random() * 6
                });
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                pieces.forEach(p => {
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                    p.y += p.speed;
                    p.x += Math.sin(p.angle);
                    p.angle += 0.1;
                    if(p.y > canvas.height) p.y = -20;
                });
                requestAnimationFrame(draw);
            }
            draw();
        }

        initBoard();
        initHand();

    </script>
</body>
</html>