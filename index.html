<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Chem: Classroom</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --neon-blue: #00f3ff;
            --neon-green: #00ff9d;
            --neon-red: #ff0055;
            --purple: #6a0dad;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: #e2e8f0; margin: 0; height: 100vh;
            display: flex; flex-direction: column; overflow: hidden; user-select: none;
        }

        /* --- LOGIN SCREEN --- */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #020617; z-index: 99999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .login-box {
            width: 80%; max-width: 300px;
            text-align: center;
        }
        .login-input {
            width: 100%; padding: 15px; margin: 20px 0;
            background: #1e293b; border: 2px solid var(--neon-blue);
            color: white; font-size: 18px; border-radius: 8px; outline: none; text-align: center;
        }
        .start-btn {
            background: var(--neon-blue); color: #000;
            padding: 12px 40px; font-size: 20px; font-weight: bold; border: none;
            border-radius: 50px; cursor: pointer; box-shadow: 0 0 15px var(--neon-blue);
        }

        /* --- HEADER --- */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 15px; background: rgba(30, 41, 59, 0.95);
            border-bottom: 2px solid var(--neon-blue);
        }
        .student-name { color: var(--neon-blue); font-weight: bold; font-size: 14px; text-transform: uppercase; border: 1px solid var(--neon-blue); padding: 4px 8px; border-radius: 4px; }
        .lives-box { font-size: 20px; color: var(--neon-red); letter-spacing: 3px; }

        /* --- GAME OVER --- */
        .game-over-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10000; animation: fadeIn 1s;
        }
        .game-over-text { font-size: 30px; font-weight: bold; color: white; text-align: center; margin-bottom: 20px; }
        .report-btn {
            padding: 15px 30px; font-size: 18px; font-weight: bold;
            border: none; border-radius: 50px; cursor: pointer; margin-top: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5); text-decoration: none; display: inline-block;
        }

        /* --- BẢNG VÀ THẺ --- */
        #board-wrapper { flex: 2; overflow: auto; padding: 20px; background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 20px 20px; }
        .grid-container { display: grid; grid-template-columns: 25px repeat(18, 40px); grid-template-rows: 25px repeat(7, 40px); gap: 3px; margin: 0 auto; width: max-content; }
        .label-cell { display: flex; align-items: center; justify-content: center; font-size: 10px; color: #64748b; }
        .slot { width: 40px; height: 40px; background: rgba(255,255,255,0.05); border: 1px solid #334155; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; border-radius: 4px; }
        .slot.filled { background: rgba(0,255,157,0.2); border-color: var(--neon-green); color: var(--neon-green); }
        .slot.incorrect { background: rgba(255,0,85,0.3); border-color: var(--neon-red); }
        
        #hand-container { flex: 1; padding: 10px; background: #0b1120; border-top: 1px solid #334155; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        .card-info { width: 95%; max-width: 400px; background: #1e293b; border: 1px solid #334155; padding: 8px; margin-bottom: 8px; display: grid; grid-template-columns: 50px 1fr auto; align-items: center; border-radius: 8px; }
        .card-info.selected { border: 2px solid var(--neon-blue); background: #0f172a; }
        .symbol-large { font-size: 20px; font-weight: bold; color: white; background: var(--neon-blue); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 6px; text-shadow: 1px 1px 1px black;}

        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color:var(--neon-blue); margin-bottom:10px;">LỚP HỌC KẾT NỐI</h2>
            <p style="color:#94a3b8">Vui lòng nhập họ tên thật để lấy điểm</p>
            <input type="text" id="studentNameInput" class="login-input" placeholder="Ví dụ: Nguyễn Văn A">
            <button class="start-btn" onclick="startGame()">VÀO LỚP</button>
        </div>
    </div>

    <div class="game-over-overlay" id="endScreen">
        <div class="game-over-text" id="endMessage"></div>
        <div style="color:#ccc; margin-bottom: 20px;" id="endSubMessage"></div>
        <a id="submitBtn" class="report-btn" target="_blank">GỬI KẾT QUẢ CHO GV &#10148;</a>
        <button onclick="location.reload()" style="margin-top:20px; background:transparent; border:1px solid #fff; color:#fff; padding:10px 20px; border-radius:20px;">Chơi Lại</button>
    </div>

    <div class="header">
        <div class="student-name" id="displayStudentName">HỌC SINH</div>
        <div class="lives-box" id="lives-display">&#10084;&#10084;&#10084;</div>
    </div>

    <div id="board-wrapper">
        <div class="grid-container" id="periodic-table"></div>
    </div>

    <div id="hand-container"></div>

    <script>
        // --- CẤU HÌNH CỦA GIÁO VIÊN (SẼ SỬA Ở BƯỚC 2) ---
        // Bạn sẽ dán Link Google Form đã điền sẵn (Pre-filled link) vào đây
        // Nhớ giữ nguyên các dấu ngoặc kép
        const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSfeG0Q74WqCSRE0TLfksBaWPuXn_MKkKu0NqCn_JEvbH4q77w/viewform?usp=pp_url&entry.946243836="; 
        // Ví dụ: "https://docs.google.com/forms/d/e/.../viewform?usp=pp_url&entry.123456="
        
        // --- DỮ LIỆU GAME ---
        const elementsData = [
             { z: 1, row: 1, col: 1, sym: 'H', name: 'Hydrogen', conf: '1s¹' },
            { z: 2, row: 1, col: 18, sym: 'He', name: 'Helium', conf: '1s²' },
            { z: 3, row: 2, col: 1, sym: 'Li', name: 'Lithium', conf: '[He]2s¹' },
            { z: 4, row: 2, col: 2, sym: 'Be', name: 'Beryllium', conf: '[He]2s²' },
            { z: 5, row: 2, col: 13, sym: 'B', name: 'Boron', conf: '...2s²2p¹' },
            { z: 6, row: 2, col: 14, sym: 'C', name: 'Carbon', conf: '...2s²2p²' },
            { z: 7, row: 2, col: 15, sym: 'N', name: 'Nitrogen', conf: '...2s²2p³' },
            { z: 8, row: 2, col: 16, sym: 'O', name: 'Oxygen', conf: '...2s²2p⁴' },
            { z: 9, row: 2, col: 17, sym: 'F', name: 'Fluorine', conf: '...2s²2p⁵' },
            { z: 10, row: 2, col: 18, sym: 'Ne', name: 'Neon', conf: '...2s²2p⁶' },
            { z: 11, row: 3, col: 1, sym: 'Na', name: 'Sodium', conf: '[Ne]3s¹' },
            { z: 12, row: 3, col: 2, sym: 'Mg', name: 'Magnesium', conf: '[Ne]3s²' },
            { z: 13, row: 3, col: 13, sym: 'Al', name: 'Aluminium', conf: '...3s²3p¹' },
            { z: 14, row: 3, col: 14, sym: 'Si', name: 'Silicon', conf: '...3s²3p²' },
            { z: 15, row: 3, col: 15, sym: 'P', name: 'Phosphorus', conf: '...3s²3p³' },
            { z: 16, row: 3, col: 16, sym: 'S', name: 'Sulfur', conf: '...3s²3p⁴' },
            { z: 17, row: 3, col: 17, sym: 'Cl', name: 'Chlorine', conf: '...3s²3p⁵' },
            { z: 18, row: 3, col: 18, sym: 'Ar', name: 'Argon', conf: '...3s²3p⁶' }
        ];

        let currentUser = "";
        let lives = 3;
        let selectedElement = null;
        let selectedCardDiv = null;
        let gameActive = false;

        // BẮT ĐẦU GAME
        function startGame() {
            const input = document.getElementById('studentNameInput').value.trim();
            if (!input) { alert("Em chưa nhập tên!"); return; }
            currentUser = input;
            document.getElementById('displayStudentName').innerText = currentUser;
            document.getElementById('login-overlay').style.display = 'none';
            gameActive = true;
            initBoard(); initHand();
        }

        // KẾT THÚC GAME (XỬ LÝ LINK GOOGLE FORM)
        function endGame(status) {
            gameActive = false;
            const screen = document.getElementById('endScreen');
            const msg = document.getElementById('endMessage');
            const sub = document.getElementById('endSubMessage');
            const btn = document.getElementById('submitBtn');

            screen.style.display = 'flex';
            
            // 1. Tạo Link nộp bài thông minh
            // Nếu GV chưa cài đặt link thì chỉ hiện thông báo
            if (GOOGLE_FORM_URL === "") {
                btn.style.display = "none";
                sub.innerText = "Giáo viên chưa cài đặt link nộp bài.";
            } else {
                // Ghép tên và kết quả vào link form
                // Giả sử link là: ...entry.123= (Tên) & entry.456= (Kết quả)
                // Ta sẽ nối chuỗi đơn giản
                const finalLink = `${GOOGLE_FORM_URL}${encodeURIComponent(currentUser)} - ${status}`;
                btn.href = finalLink;
            }

            if (status === "WIN") {
                screen.style.background = "rgba(0, 100, 0, 0.95)";
                msg.innerText = "CHIẾN THẮNG!";
                sub.innerText = "Em đã hoàn thành xuất sắc.";
                btn.style.background = "#00ff9d"; btn.style.color = "#000";
            } else {
                screen.style.background = "rgba(75, 0, 130, 0.95)";
                msg.innerText = "HẾT MẠNG RỒI!";
                sub.innerText = "Em đã sai 3 lần.";
                btn.style.background = "#ff0055"; btn.style.color = "#fff";
            }
        }

        // --- CORE GAME LOGIC ---
        function initBoard() {
            const table = document.getElementById('periodic-table');
            table.innerHTML = ""; // Clear cũ
            // Label
            let corner = document.createElement('div'); corner.className='label-cell'; corner.innerText="N/CK"; table.appendChild(corner);
            for(let c=1; c<=18; c++) { let d=document.createElement('div'); d.className='label-cell'; d.innerText=c; table.appendChild(d); }
            
            for(let r=1; r<=7; r++) {
                let rowL = document.createElement('div'); rowL.className='label-cell'; rowL.innerText=r; table.appendChild(rowL);
                for(let c=1; c<=18; c++) {
                    let slot = document.createElement('div');
                    let el = elementsData.find(e=>e.row===r && e.col===c);
                    if(el) {
                        slot.className='slot'; slot.dataset.z=el.z;
                        slot.onclick = ()=>checkMove(slot);
                    } else {
                        // Ẩn ô thừa
                         const isMain = (r <= 3 && (c<=2 || c>=13)) || (r==4 && c<=2);
                         slot.className='slot'; slot.style.visibility='hidden';
                    }
                    table.appendChild(slot);
                }
            }
        }

        function initHand() {
            const hand = document.getElementById('hand-container');
            hand.innerHTML = "";
            const shuffled = [...elementsData].sort(()=>0.5-Math.random());
            shuffled.forEach(el => {
                let c = document.createElement('div'); c.className='card-info';
                c.innerHTML = `<div class="symbol-large">${el.sym}</div><div><b>${el.name}</b><br><small>${el.conf}</small></div>`;
                c.onclick = ()=> {
                    if(!gameActive) return;
                    if(selectedCardDiv) selectedCardDiv.classList.remove('selected');
                    selectedCardDiv = c; selectedElement = el; c.classList.add('selected');
                }
                hand.appendChild(c);
            });
        }

        function checkMove(slot) {
            if(!gameActive || !selectedElement || slot.classList.contains('filled')) return;
            
            if(parseInt(slot.dataset.z) === selectedElement.z) {
                // Đúng
                slot.className = 'slot filled'; slot.innerText = selectedElement.sym;
                selectedCardDiv.remove(); selectedElement=null; selectedCardDiv=null;
                if(document.getElementById('hand-container').children.length === 0) endGame("WIN");
            } else {
                // Sai
                slot.classList.add('incorrect'); setTimeout(()=>slot.classList.remove('incorrect'), 500);
                lives--;
                let hearts = ""; for(let i=0;i<lives;i++) hearts+="\u2764 ";
                document.getElementById('lives-display').innerText = hearts;
                if(lives===0) endGame("LOSE");
            }
        }
    </script>
</body>
</html>

